<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>编辑订单</title>
</head>
<body>

	<include file= "./home"/>
	编辑订单
	<form action="{:U('Home/Order/edit')}?id={$_GET['id']}" method="post">
		<p>身份　证：<input type="text" name="ID" value="{$data['ID_card']}" disabled="">*</p>
		<p>入住日期：<input type="date" name="aDay" value="{$data['A_date']}">*</p>
		<p>退房日期：<input type="date" name="bDay" value="{$data['B_date']}">*</p>

		<p>订单类型：
		  <select id="style" name="style" onchange="loadType_Price()">
			<foreach name="styles" item="name" key="style" >
				<option value ="{$style}">{$name}</option>
			</foreach>
	      </select>

	      <select id="type" name="type" onchange="loadPrice()">
			<foreach name="types" item="name" key="type" >
				<option value ="{$type}">{$name}</option>
			</foreach>
	      </select>

	      <select id="price" name="price">
			<option value ="{$prices['bid_price']}" selected="">标　价 | ￥{$prices['bid_price']}</option>
			<option value ="{$prices['stu_price']}">学生价 | ￥{$prices['stu_price']}</option>
			<option value ="{$prices['vip_price']}">会员价 | ￥{$prices['vip_price']}</option>
			<option value ="{$prices['corp_price']}">协议价 | ￥{$prices['corp_price']}</option>
			<option value ="{$prices['inner_price']}">内部价 | ￥{$prices['inner_price']}</option>
	      </select>
	    </p>

	    <p>订单来源：
          <select name="source">
      		<foreach name="sources" item="name" key="source" >
      			<option value ="{$source}">{$name}</option>
      		</foreach>
          </select>
	    </p>
	    
	    <p>支付方式：
	      <!-- <select name="mode">
      		<option value ="0">现金支付</option>
      		<option value ="1">网上支付</option>
          </select> -->
	    	<input type="radio" name="mode" value="0" checked="">现金
	    	<input type="radio" name="mode" value="1">网付
	    </p>
		<p>备　　注：<input type="text" name="note" value="{$data['note']}"></p>

		<div>
			<p>入住人员登记</p>
			<?php
				$book_info = json_decode($data['book_info'], true);
				$people_info = $book_info['people_info'];
			?>
			<p>
				姓名　(一)<input type="text" name="info[0][name]" value="{$people_info[0]['name']}">*<br/>
				身份证(一)<input type="text" name="info[0][ID_card]" value="{$people_info[0]['ID_card']}">*<br/>
			</p>
			<p>
				姓名　(二)<input type="text" name="info[1][name]" value="{$people_info[1]['name']}"><br/>
				身份证(二)<input type="text" name="info[1][ID_card]" value="{$people_info[1]['ID_card']}"><br/>
			</p>
		</div>

		<p>手　　机：<input type="text" name="phone" value="{$data['phone']}">*</p>
		<input type="submit" value="提交" /> <input type="button" name="back" value="返回" onclick="javascript:history.go(-1);"/>
	</form>

	<script language="JavaScript">/*根据style，加载type和price*/
		
		var type_price_url = "{:U('Home/Client/getType_PriceByStyle')}";
		function loadType_Price(){
			var style = $("#style").val();

			/*<select id="type" name="type">
			<foreach name="types" item="name" key="type" >
				<option value ="{$type}">{$name}</option>
			</foreach>
	      </select>*/

			$.ajax({
	        	url: type_price_url,
	        	type: 'post',
	        	data: {style: style},
	        	dataType: 'json',
	        	success: function(data) {

	        		// alert(style);

	        		if (data['types'] && data['prices']) {
	        			
	        			var types = eval(data['types']);

	        			var typeHTML = '<select id="type" name="type">';
	        			var TYPE = $("#type");

	        			var subStr = '';
	        			for (var i in types) {
	        				subStr += '<option value ="'+ i +'">'+ types[i] +'</option>';
	        			}
	        			typeHTML += subStr + '</select>';

	        			TYPE.html(typeHTML);

			// ===============================================================
			
						setPrice(style, data['prices']);

			// ===============================================================

	        		};

					if (data['groupons']) {/* 如果是团购*/
						var groupons = eval(data['groupons']);

	        			var grouponHTML = '<select id="groupon" name="groupon">';
	        			var PRICE = $("#price");

	        			var subStr = '';
	        			for (var i in groupons) {
	        				subStr += '<option value ="'+ i +'">'+ groupons[i] +'</option>';
	        			}
	        			grouponHTML += subStr + '</select>';

	        			PRICE.after(grouponHTML);
					} else {
						
						// 去除选择团购平台的select
						$("#groupon").remove();
					}
	        	}
	        })
		}

		var price_url = "{:U('Home/Client/getPriceByStyle_Type')}";
		function loadPrice(){/*根据style和type，加载price*/

			var style = $("#style").val();
			var type = $("#type").val();

			$.ajax({
	        	url: price_url,
	        	type: 'post',
	        	data: {style: style, type: type},
	        	dataType: 'json',
	        	success: function(data) {

	        		if (data['prices']) {
	        			
	        			setPrice(style, data['prices']);
	        		};
	        	}
	        })
		}

		function setPrice(style, pricesJSON){/*设置相应的价格*/
			var prices = eval(pricesJSON);

			var priceHTML = '<select id="price" name="price">';
			var PRICE = $("#price");

			var subStr = '';
			switch(style) {
				case '0':
					subStr = '<option value ="'+ prices['bid_price'] +'" selected="">标　价 | ￥'+ prices['bid_price'] +'</option>'+
						'<option value ="'+ prices['stu_price'] +'">学生价 | ￥'+ prices['stu_price'] +'</option>'+
						'<option value ="'+ prices['vip_price'] +'">会员价 | ￥'+ prices['vip_price'] +'</option>'+
						'<option value ="'+ prices['corp_price'] +'">协议价 | ￥'+ prices['corp_price'] +'</option>'+
						'<option value ="'+ prices['inner_price'] +'">内部价 | ￥'+ prices['inner_price'] +'</option>';
					// alert(0);
					break;
				case '1':
					subStr = '<option value ="'+ prices['bid_price'] +'" selected="">标　价 | ￥'+ prices['bid_price'] +'</option>'+
						'<option value ="'+ prices['stu_price'] +'">学生价 | ￥'+ prices['stu_price'] +'</option>'+
						'<option value ="'+ prices['vip_price'] +'">会员价 | ￥'+ prices['vip_price'] +'</option>'+
						'<option value ="'+ prices['inner_price'] +'">特殊价 | ￥'+ prices['inner_price'] +'</option>';
					// alert(1);
					break;
				case '2':
					subStr = '<option value ="'+ prices['groupon_price'] +'" selected="">团购价 | ￥'+ prices['groupon_price'] +'</option>';
					break;
				default:
					alert('无此类型！');
					return;
					break;
			}

			priceHTML += subStr + '</select>';

			PRICE.html(priceHTML);
		}

		function changeVerify(){
			var timenow = new Date().getTime();
			document.getElementById('verifyImg').src='__URL__/verify/'+timenow;
		}
	</script>
	
</body>
</html>